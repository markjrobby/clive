meta:
  name: User Onboarding
  version: 2.1.0
  description: New user signup and plan selection flow
  owner: "@markjrobert"
  tags:
    - onboarding
    - signup

nodes:
  start:
    name: Start
    type: entry
    copy:
      heading: "Welcome to JobAlertBot!"
      body: "Let's get you set up in 60 seconds."
    buttons:
      - label: "Let's go!"
        goto: select_role
        style: primary

  select_role:
    name: Select Role
    type: decision
    handler: src/handlers/onboarding.py:select_role
    copy:
      heading: "What role are you looking for?"
    buttons:
      - label: "Software Engineer"
        goto: select_level
        data: { role: "swe" }
      - label: "Product Manager"
        goto: select_level
        data: { role: "pm" }
      - label: "Designer"
        goto: select_level
        data: { role: "design" }
      - label: "Other"
        goto: custom_role

  custom_role:
    name: Enter Custom Role
    type: input
    handler: src/handlers/onboarding.py:custom_role
    copy:
      heading: "What role are you looking for?"
      placeholder: "e.g., Data Scientist"
    validation:
      - type: min_length
        value: 2
        error: "Please enter a role"
    transitions:
      - to: select_level
        trigger: valid_input
      - to: custom_role_error
        trigger: invalid_input

  custom_role_error:
    name: Role Input Error
    type: error
    parent: custom_role
    copy:
      body: "Please enter a valid role (at least 2 characters)"
    transitions:
      - to: custom_role
        trigger: retry

  select_level:
    name: Select Level
    type: decision
    handler: src/handlers/onboarding.py:select_level
    copy:
      heading: "What's your experience level?"
    buttons:
      - label: "Entry (0-2 years)"
        goto: select_location
        data: { level: "entry" }
      - label: "Mid (2-5 years)"
        goto: select_location
        data: { level: "mid" }
      - label: "Senior (5+ years)"
        goto: select_location
        data: { level: "senior" }

  select_location:
    name: Select Location
    type: decision
    handler: src/handlers/onboarding.py:select_location
    copy:
      heading: "Where do you want to work?"
    buttons:
      - label: "Remote Only"
        goto: confirm
        data: { location: "remote" }
      - label: "Hybrid"
        goto: enter_city
        data: { location: "hybrid" }
      - label: "On-site"
        goto: enter_city
        data: { location: "onsite" }

  enter_city:
    name: Enter City
    type: input
    handler: src/handlers/onboarding.py:enter_city
    copy:
      heading: "Which city?"
      placeholder: "e.g., San Francisco"
    transitions:
      - to: confirm
        trigger: valid_input

  confirm:
    name: Confirm Preferences
    type: action
    handler: src/handlers/onboarding.py:confirm
    copy:
      heading: "Here's your profile:"
      body: "Role: {role}\nLevel: {level}\nLocation: {location}"
    buttons:
      - label: "Looks good!"
        goto: payment
        style: primary
      - label: "Start over"
        goto: select_role
        style: secondary

  payment:
    name: Payment
    type: action
    handler: src/handlers/onboarding.py:payment
    copy:
      heading: "Complete Your Payment"
      body: "Please enter your payment details to activate your account."
    buttons:
      - label: "Pay Now"
        goto: thank_you
        style: primary
      - label: "Back"
        goto: confirm
        style: secondary

  thank_you:
    name: Thank You
    type: action
    handler: src/handlers/onboarding.py:thank_you
    copy:
      heading: "Thank You!"
      body: "Your payment has been received. We appreciate your business."
    buttons:
      - label: "Continue"
        goto: complete
        style: primary

  complete:
    name: Setup Complete
    type: exit
    handler: src/handlers/onboarding.py:complete
    copy:
      heading: "You're all set!"
      body: "I'll send you matching jobs as soon as I find them."
    state:
      sets:
        - onboarding_complete
